# Home Solar Potential Explorer — UI Flow Summary (v1.2)

This document summarizes the current steps, state transitions, and how Step 6A (Quote action card) is exposed in `sales_agent_v1.1/generated-page-v1.2_en.html`.

## Steps overview

- __Step 1 (`data-step="1"`)__ — Address input
  - Entry: `boot()` → `showStep(1)`.
  - Action: Enter address → click `#startExploreBtn`.
  - Next: `bindStep1()` sets `state.address`, updates `#addrLabel`, then `showStep(2)`.

- __Step 2 (`data-step="2"`)__ — Roof confirmation (map)
  - Action: Tap roof → enable `#confirmRoofBtn`.
  - Next: Click confirm → `showStep(3)` (`bindStep2()`).

- __Step 3 (`data-step="3"`)__ — AI analysis (loading)
  - Auto: `runAnalysis()` timers → `showStep(4)`.

- __Step 4 (`data-step="4"`)__ — 3D model + mini plan strip
  - Mini plan buttons (`#schemesStrip4 .scheme-card-mini`) handled in `bindStep4()`.
  - Click only updates KPIs via `applyValuePresentation(conf)` and highlights selection.
  - Default selection: `selectScheme('smart')`.
  - Note: __No navigation to Step 5/6 from here by default__.

- __Step 5 (`data-step="5"`)__ — Plan interaction (large cards)
  - Large plan buttons (`.scheme-card`) handled in `bindStep5()`.
  - Click: updates 3D visuals + KPIs, then `showStep(6)` after 300ms.

- __Step 6 (`data-step="6"`)__ — Value presentation
  - Title set to "System budget (incl. tax)".
  - Values: __budget/payback/self-consumption as ranges__ using `computeRangesFromConf(conf)`.
  - CTA: `#openLeadBtn` opens lead modal (Step 7).
  - Triggers Step 6A visibility (see below).

- __Step 6A (independent `#card6A`)__ — Quote action card
  - Not a `data-step`; controlled inside `showStep(n)`.
  - When `showStep(6)` runs: `#card6A` is shown (and one-time `s6a_expose` tracking).
  - Contents: budget range, payback range, self-consumption range, annual savings range, an English disclaimer, and three buttons (Copy, Share, Refine info).
  - Data updates via `update6ACard(conf)` (called at the end of `applyValuePresentation(conf)`).

- __Step 7 (`data-step="7"`)__ — Submitted successfully
  - Shown after valid submission from lead modal.

## Key functions and references

- `showStep(n)` (lines ~571–593): toggles `data-step` cards; also toggles `#card6A` when `n === 6`.
- `bindStep4()` (lines ~802–840): handles mini plan strip; __no `showStep(5|6)` call__.
- `bindStep5()` (lines ~865–924): large plan cards; on click → `applyValuePresentation(conf)` → `showStep(6)`.
- `applyValuePresentation(conf)` (lines ~1059–1087): fills Step 6 values as ranges and calls `update6ACard(conf)`.
- `bindStep6A()` (lines ~953–997): copy/share/refine buttons; share includes link fallback.
- `computeRangesFromConf(conf)` (lines ~999–1023): central range computation for budget/savings/self-use/ROI.

## Why you may not see Step 6A

- `#card6A` is only visible when `showStep(6)` is called.
- From Step 4, there is currently __no__ UI action that navigates to Step 5 or Step 6.
- Therefore, unless you click a large plan in Step 5 (or call `showStep(6)` from console), Step 6A remains hidden.

## Recent changes (Aug 28, 2025)

- __Step 6__
  - Title changed to "System budget (incl. tax)".
  - Main value displays __budget range__ (not savings).
  - Payback and self-consumption displayed as ranges.
  - Added an English disclaimer below the breakdown.
- __Step 6A__
  - Range display + English disclaimer maintained; copy/share always include link.
- __Step 4__
  - Self-consumption changed to range for consistency; other fields unchanged.

## Options to enable navigation to Step 6/6A from Step 4

- __Option A (recommended)__: in `bindStep4()` → after `selectScheme(key)`, call `showStep(6)` to jump directly.
- __Option B__: from Step 4 jump to Step 5 via `showStep(5)`; then Step 5 large card leads to Step 6.
- __Option C__: add an explicit CTA in Step 4 like “View detailed quote” to navigate.

## Copy/share template (English)

Generated by `buildShareText(conf)`, always includes:
- Plan
- System size
- Budget (incl. tax): `$low – $high`
- Payback: `a.b–c.d years`
- Self-consumption: `x% – y%`
- Annual savings: `$low – $high`
- Note + `Link: <current page>`

---

For any further changes, search by these anchors inside `generated-page-v1.2_en.html`:
- `showStep(`
- `bindStep4()` / `bindStep5()`
- `applyValuePresentation(`
- `computeRangesFromConf(`
- `update6ACard(`
- `bindStep6A()`
