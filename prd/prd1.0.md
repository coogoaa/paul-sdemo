1. 背景与目标
1.1 背景
开发一款创新的AI营销工具，以 H5页面的形式提供给安装商。采用“Chatbot + 交互式卡片 + 实时3D模型”的交互模式，让终端用户（房主）快速获得一份个性化、可视化的太阳能初步提案，核心目标：促使用户留下联系方式，为安装商创造高质量、高意向的销售线索。
1.2 目标用户
- 终端用户 (房主): 对太阳能感兴趣，希望快速了解自家潜力、预估成本和节省金额，但对复杂的技术细节感到困惑。
- 业务客户 (安装商): 希望降低获客成本，提高线索转化率，并使用现代化的工具提升品牌形象和销售效率。
1.3 关注指标
- 核心指标: 线索转化率 (留资用户数 / 总访问用户数)。
- 辅助指标: 用户平均交互时长、方案分享率、各环节流失率、安装商对线索质量的评分。
2. Agent 交互流程
2.1 主要流程介绍
- 采用对话的方式，引导客户通过交互卡片式填写或直接获取用户的地址
- 结合屋顶面积、屋顶形态、是否存在泳池等大功率高能耗设施等，推算用户画像需求等级：基础型、标准型、高耗能型、超高能耗型。
- 结合屋顶信息、街景信息、周边楼层分布等信息，还原屋顶 3D 结构及墙体结构
- 对于未安装光伏系统的客户，同步生成三套光伏设备提案，包括：
  - 智慧节省：光伏面板（数量低配）+逆变器
  - 高效能源：光伏面板（数量高配）+逆变器
  - 能源独立：光伏面板（数量高配）+混合逆变器
- 对于已安装光伏系统的客户，推荐储能系统扩容提案。
- 吸引用户留下联系方式，获得线索，引导客户做进一步的详细费用预估。
2.2 交互流程
暂时无法在Lark文档外展示此内容
3. AI 识别及计算逻辑
3.1 房屋信息获取
- 目的：获取屋顶的面积，用以估算后续的用电需求
- 输入：用户提供的地址
- 处理：
1. 调用 Google Maps API 将地址转换为经纬度。
2. 加载对应位置的高清卫星地图。
3. 用户在地图上点击屋顶，或框选屋顶，调用 Segment Anything 模型，自动提取并高亮屋顶的2D轮廓。
  - 示例图
点击或框选前
[图片]

点击或框选后
[图片]

4. 用户提交地图信息，传入用户提交的的地图比例尺和分割像素坐标，供后端计算屋顶面积
5. 楼层判断：（用以还原3D 建模，后期用以作为评估用电信息的参数）
  - 方案 1：借助 google map 的 solar api 获取高度信息，估算楼层（不确定是否可行）
  - 方案 2：调用 Google Street View API，获取房屋正面街景截图，用于后续楼层判断。不确定是否可行
  - 方案 3：根据历史数据预设用户提交的地址周边的楼层分布，取默认值。
    - 片区抽样，需要标注数据？
3.2 屋顶结构分析
- 目的：估算屋顶的实际可用面积，作为估算系统容量的依据
- 输入：屋顶2D轮廓及卫星图。
- 处理：
1. 计算屋顶投影面积 (A_roof_proj)。
  - 根据地图比例计算
2. 判断屋顶复杂度: 利用LLM的视觉能力，将屋顶分为三类，并给出屋顶综合可用系数：
  - 考虑到屋顶的复杂度、屋顶坡度、最佳可用朝向、障碍与边缘留空及面板布局间隙等按章规范要求等因素，需要把要把2D投影面积转为实际可用面积，考虑因素如下：
参数
名称
描述
A_proj_total
屋顶总投影面积
在谷歌地图上圈出的整个屋顶的2D面积。
C_slope
坡度修正
将2D投影面积转换为3D实际表面积。考虑坡度角度
F_orient
朝向可用性系数
估算屋顶总面积中，朝向合适（北/东/西）的部分占比。通常南向不可用，且部分屋顶结构复杂。
F_setback
障碍与边缘留空系数
扣除屋脊、天窗、通风口以及风荷载安全边距所占的面积。
F_pack
布局与间隙系数
考虑光伏板之间安装、固定、布线所需的必要间隙，也称为排布损失。

  - 简化逻辑，根据屋顶类型，预设可用系数。系数需要看下更多的样本图片来调整一下
    - 平面屋顶：没有坡面。F_combined = 0.80。
    - 简单屋顶： 2-4个大坡面。F_combined = 0.50。
    - 复杂屋顶：多个小坡面、老虎窗等。F_combined = 0.35。
    - 屋顶样例如下：
平面屋顶
[图片]

简单屋顶
[图片]

复杂屋顶
[图片]


  - 屋顶复杂度识别提示词设计：待补充

  - 准确率验证：待补充

  - 兜底方案：若

3. 计算屋顶理论最大系统容量
这个屋顶面积计算,需要考虑再看下历史数据和有面积的图片，系数可能要在调整一下
- 预设：
  - 单块光伏面板的面积 (A_module):约约 1.9 m² (基于 1.7m x 1.1m 的常见尺寸)。
  - 使用 450w （0.45kW）的单块面板功率
- 计算屋顶最大物理潜力：计算屋顶最大可铺设的光伏面板数量
  - 使用 N_max =(A_roof_proj × F_combined) / 1.9 公式估算。
  - 计算该屋顶理论系统容量：P_max = N_max × 0.45 kW
- 计算示例：
  - 以一个投影面积为 135.777 平米的屋顶为例
  - 4 Havana Ln, Bray Park QLD 4500澳大利亚（-27.283840968273093, 152.9529509632987）
原图
[图片]

测量图（来自张刚）
[图片]


- 是一个复杂屋顶，计算屋顶最大可铺设的光伏面板数量和理论最大容量
## 计算理论最大光伏面板数量
使用公式：N_max =(A_roof_proj × F_combined) / 1.9
N_max = (135.777 * 0.35) / 1.9 = 25.012
向下取整为 25 块面板

## 计算理论最大容量

使用公式：P_max = N_max × 0.45 kW
P_max = 25 × 0.45 = 11.25kW

## 如果按照 系数0.5计算
N_max = (135.777 * 0.5) / 1.9 = 35
P_max = 35 × 0.45 = 15.75kW


4. 识别已有光伏板: 使用LLM视觉能力判断屋顶是否已安装光伏板，如是，则触发“储能升级”流程。
详见 3.6 储能方案升级

3.3 用户画像与需求预判（用于兜底，提前计算）
- 目的：根据投影面积，匹配客户画像，匹配对应的推荐系统容量区间，用于面积区间
- 输入：A_roof_proj，是否配备游泳池等高能耗设施
- 处理：
1. 高能耗特征识别: 调用LLM视觉能力，判断后院是否存在游泳池或网球场。面积和关联特征命中其一即归类到对应的画像。
2. 用户画像匹配: 根据以下规则表进行匹配
暂时无法在Lark文档外展示此内容
3. 计算系统组件方案
- 根据系统容量估算面板数量区间
面板数量 = 推荐系统容量 / 单片面板功率
预设单片面板功率为 450w，数量向下取整
给出区间范围，用以最终多个方案生成和 3D 渲染
- 根据系统容量估算逆变器功率
按照容配比比 1:1.1 估算
估算出逆变器功率 = 面板系统容量 * 1.1
给出区间范围，用以最终多个方案生成和 3D 渲染
- 储能方案配置（可选）
根据用户画像预设储能配置：
- 基础型：5 kWh 电池储能系统；覆盖夜间基础用电，提升自用率
- 标准型：10 kWh 电池储能系统；满足大多数家庭夜间用电，基本告别晚高峰电价
- 高能耗型：13.5 kWh+ 电池储能系统；轻松应对高耗能设备，并在停电时提供更持久的备用电源
- 报价计算：
- 总报价 = (硬件成本 + 辅材及安装费) × (1 + 利润率)
- 硬件成本: 根据方案预设的组件（面板、逆变器、电池）价格计算。
- 辅材及安装费: 基础费 (如$1500) + 每kW附加费 (如$150) × 系统容量。

系统含税，包含安装辅材等费用，不含补贴
- 经济效益计算：
  - 预设参数：
A. 系统配置参数 (来自用户选择的方案)
- P_solar: 光伏板总容量 (kW)
- Has_Battery: 是否包含电池 (True/False)

B. 地理与市场参数 (需在后台按州/领地配置)
- 年均光照小时数据：按4.18 预估
- 电网平均电价：0.3 AUD/Kwh
- 太阳能上网电价：0.07 AUD/Kwh

C. 行为假设参数 (需在后台配置)
无电池方案的自用率。默认值: 30%。
有电池方案的自用率。默认值: 85%。

D. 客户基准参数 (来自用户画像)
客户预估的年用电量 (kWh)。
基础型: 5,000 kWh
标准型: 7,500 kWh
高耗能型: 10,000 kWh
超高耗能型: 15,000 kWh
- 计算过程：
## 年总发电量
年总发电量 = P_solar × 4.18 × 365

## 年自用电量

- 无电池
年自用电量: 年发电量 × 无电池方案的自用率
- 有电池
年自用电量: 年发电量 × 有电池方案的自用率

## 年上网电量
年上网电量= 年总发电量 - 年自用电量

## 年上网收益
年上网收益 = 年上网电量 × 太阳能上网电价



3.4 提案生成
1. 目的：生成最终展示给用户的提案
2. 方案 1：根据屋顶面积估算
- 输入: P_max：屋顶理论系统容量
- 处理：生成三个方案
  - 系统组件估算
暂时无法在Lark文档外展示此内容
备注：
  - 储能方案（可选）
根据用户画像预设储能配置：
- 智慧节省：5 kWh 电池储能系统；覆盖夜间基础用电，提升自用率
- 高效能源：10 kWh 电池储能系统；满足大多数家庭夜间用电，基本告别晚高峰电价
- 能源独立：13.5 kWh+ 电池储能系统；轻松应对高耗能设备，并在停电时提供更持久的备用电源

- 报价计算：
- 总报价 = (硬件成本 + 辅材及安装费) × (1 + 利润率)
- 硬件成本: 根据方案预设的组件（面板、逆变器、电池）价格计算。
- 辅材及安装费: 基础费 (如$1500) + 每kW附加费 (如$150) × 系统容量。

系统预计费用区间：系统预计费用上下浮动 10%
系统含税，包含安装辅材等费用，不含补贴

- 经济效益计算：
  - 预设参数：
A. 系统配置参数 (来自用户选择的方案)
- P_solar: 光伏板总容量 (kW)
- Has_Battery: 是否包含电池 (True/False)

B. 地理与市场参数 (需在后台按州/领地配置)
- 年均光照小时数据：按4.18 预估
- 电网平均电价：0.3 AUD/Kwh
- 太阳能上网电价：0.07 AUD/Kwh

C. 行为假设参数 (需在后台配置)
无电池方案的自用率。默认值: 30%。
有电池方案的自用率。默认值: 85%。

D. 客户基准参数 (来自用户画像)
客户预估的年用电量 (kWh)。
基础型: 5,000 kWh
标准型: 7,500 kWh
高耗能型: 10,000 kWh
超高耗能型: 15,000 kWh
- 计算过程：
## 年总发电量
年总发电量 = P_solar × 4.18 × 365

## 年自用电量

- 无电池
年自用电量: 年发电量 × 无电池方案的自用率
- 有电池
年自用电量: 年发电量 × 有电池方案的自用率

## 年上网电量
年上网电量= 年总发电量 - 年自用电量

## 年上网收益
年上网收益 = 年上网电量 × 太阳能上网电价

3.5 储能升级方案
- 当AI识别出用户提交的房屋已经有面板时，触发储能升级建议
- 根据投影面积，匹配客户画像，匹配对应的推荐系统容量区间，给出电池升级建议，这项内容跟政策比较关联，各州政策不一，暂时不给具体的报价
暂时无法在Lark文档外展示此内容
- 具体费用需要进一步勘探，引导用户留下资料
3.6 3D 房屋还原
- 输入：屋顶2D轮廓，街景截图。
- 处理:
  - 屋顶: 基于2D轮廓和预设的屋顶坡度（系统默认 23°），程序化生成3D屋顶几何体。
  - 墙体与楼层:
    - 使用 3.1 房屋信息获取 4.楼层判断的方式，判断房屋楼层（1 层、2 层常见）
    - 根据楼层数和屋顶轮廓，生成简化的墙体。
  - 组件渲染: 
    - 根据用户选择的方案，在3D模型上实时渲染光伏板（优先布局在最佳朝向）和电池墙。

3.7 异常处理与兜底
- 场景1: 图像质量不足/无法识别
  - 触发: 由 LLM 判断并返回图像是否是房屋卫星地图，图像是否足够清晰，如果不清晰则返回信息
  - 流程: 触发对话流程，引导用户重试或留资进行免费人工评估。
- 场景2: 房屋投影面积超大 (>450m²)
  - 触发: A_roof_proj 超过阈值。
  - 流程: 触发单独的对话流程，强调需要高级顾问进行定制化方案，并直接引导留资。
- 场景2: 房屋投影面积郭晓 (<20m²)
  - 触发: A_roof_proj 超过阈值。
  - 流程: 触发单独的对话流程，引导用户重新勾选地图并提交
- 场景4: 屋顶已有光伏板
  - 触发: AI识别出已有面板。
  - 流程: 切换至“储能升级”流程，提供电池加装方案建议
3.8 安全与隐私


4. 数据统计

5. 其他
- 可考虑使用房屋面积数据与 GS 现有数据，通过面积匹配的方式，进行数据比对与验证